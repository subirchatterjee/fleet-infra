apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ytdl-sub
  namespace: flux-system
spec:
  releaseName: ytdl-sub
  targetNamespace: media
  timeout: 15m
  interval: 2m0s
  chart:
    spec:
      chart: app-template
      version: "1.3.2"
      sourceRef:
        kind: HelmRepository
        name: bjw-s-helm-charts
        namespace: flux-system
  values:
    image:
      pullPolicy: Always
      repository: ghcr.io/jmbannon/ytdl-sub
      tag: "latest@sha256:07045e5a9e16f10329acaa14d6b8c7a84eece507221dfb2efde8f8427c96458d" # 2023-02-23 15:00 -0400

    controller:
      type: cronjob
      restartPolicy: OnFailure
      cronjob:
        # schedule: "0 0 5 31 2" # Disable cronjob by giving it a schedule that will never run # active nas
        schedule: "*/15 * * * *"

    command:
      - "ytdl-sub"
      - "--config=/config/config.yaml"
      - "sub"
      - "/config/subscriptions.yaml"

    env:
      TZ: America/New_York
      PUID: "568"
      PGID: "568"

    persistence:
      config:
        enabled: true
        name: ytdl-sub-config
        type: configMap
        mountPath: /config/config.yaml
        subPath: config.yaml
        readOnly: true
        defaultMode: 0755
      subscriptions:
        enabled: true
        name: ytdl-sub-subscriptions
        type: configMap
        mountPath: /config/subscriptions.yaml
        subPath: subscriptions.yaml
        readOnly: true
        defaultMode: 0755
      media:
        enabled: true
        existingClaim: nas-volume1-media

    service:
      main:
        enabled: false

    ingress:
      main:
        enabled: false

    resources:
      requests:
        cpu: 100m
        memory: 128M
      limits:
        memory: 8G
